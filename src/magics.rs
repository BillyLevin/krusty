use crate::bitboard::Bitboard;

#[derive(Clone, Copy)]
pub struct MagicNumber {
    magic: u64,
    shift: u8,
    offset: usize,
    pub blocker_mask: u64,
}

impl MagicNumber {
    pub fn get_magic_index(&self, blockers: Bitboard) -> usize {
        let blockers = Bitboard(self.blocker_mask) & blockers;
        let hash = self.magic.wrapping_mul(blockers.0);
        let index = (hash >> self.shift) as usize;
        index + self.offset
    }
}

pub const ROOK_MAGICS: [MagicNumber; 64] = [
    MagicNumber {
        magic: 0x0080004001802010,
        shift: 52,
        offset: 0,
        blocker_mask: 0x000101010101017e,
    },
    MagicNumber {
        magic: 0x0040100840012000,
        shift: 53,
        offset: 4096,
        blocker_mask: 0x000202020202027c,
    },
    MagicNumber {
        magic: 0x0080182000809000,
        shift: 53,
        offset: 6144,
        blocker_mask: 0x000404040404047a,
    },
    MagicNumber {
        magic: 0x0080100005080080,
        shift: 53,
        offset: 8192,
        blocker_mask: 0x0008080808080876,
    },
    MagicNumber {
        magic: 0x0200100420020008,
        shift: 53,
        offset: 10240,
        blocker_mask: 0x001010101010106e,
    },
    MagicNumber {
        magic: 0x0100050008140002,
        shift: 53,
        offset: 12288,
        blocker_mask: 0x002020202020205e,
    },
    MagicNumber {
        magic: 0x1880108006000100,
        shift: 53,
        offset: 14336,
        blocker_mask: 0x004040404040403e,
    },
    MagicNumber {
        magic: 0x8200060421028444,
        shift: 52,
        offset: 16384,
        blocker_mask: 0x008080808080807e,
    },
    MagicNumber {
        magic: 0x89048000C0028C61,
        shift: 53,
        offset: 20480,
        blocker_mask: 0x0001010101017e00,
    },
    MagicNumber {
        magic: 0x0452804000200080,
        shift: 54,
        offset: 22528,
        blocker_mask: 0x0002020202027c00,
    },
    MagicNumber {
        magic: 0x0489004020010011,
        shift: 54,
        offset: 23552,
        blocker_mask: 0x0004040404047a00,
    },
    MagicNumber {
        magic: 0x8402000820120044,
        shift: 54,
        offset: 24576,
        blocker_mask: 0x0008080808087600,
    },
    MagicNumber {
        magic: 0x8402000820120044,
        shift: 54,
        offset: 25600,
        blocker_mask: 0x0010101010106e00,
    },
    MagicNumber {
        magic: 0x10220010080A0005,
        shift: 54,
        offset: 26624,
        blocker_mask: 0x0020202020205e00,
    },
    MagicNumber {
        magic: 0x0001002100040200,
        shift: 54,
        offset: 27648,
        blocker_mask: 0x0040404040403e00,
    },
    MagicNumber {
        magic: 0x0002000102441082,
        shift: 53,
        offset: 28672,
        blocker_mask: 0x0080808080807e00,
    },
    MagicNumber {
        magic: 0x0000848008400062,
        shift: 53,
        offset: 30720,
        blocker_mask: 0x00010101017e0100,
    },
    MagicNumber {
        magic: 0x0800404010002000,
        shift: 54,
        offset: 32768,
        blocker_mask: 0x00020202027c0200,
    },
    MagicNumber {
        magic: 0x00A0010020104108,
        shift: 54,
        offset: 33792,
        blocker_mask: 0x00040404047a0400,
    },
    MagicNumber {
        magic: 0x0008808018005000,
        shift: 54,
        offset: 34816,
        blocker_mask: 0x0008080808760800,
    },
    MagicNumber {
        magic: 0x008400800C080080,
        shift: 54,
        offset: 35840,
        blocker_mask: 0x00101010106e1000,
    },
    MagicNumber {
        magic: 0x0204008022001480,
        shift: 54,
        offset: 36864,
        blocker_mask: 0x00202020205e2000,
    },
    MagicNumber {
        magic: 0x0C040400082D8210,
        shift: 54,
        offset: 37888,
        blocker_mask: 0x00404040403e4000,
    },
    MagicNumber {
        magic: 0x0059020000804405,
        shift: 53,
        offset: 38912,
        blocker_mask: 0x00808080807e8000,
    },
    MagicNumber {
        magic: 0x0080400080008060,
        shift: 53,
        offset: 40960,
        blocker_mask: 0x000101017e010100,
    },
    MagicNumber {
        magic: 0x80300044400C2000,
        shift: 54,
        offset: 43008,
        blocker_mask: 0x000202027c020200,
    },
    MagicNumber {
        magic: 0x802000A080100080,
        shift: 54,
        offset: 44032,
        blocker_mask: 0x000404047a040400,
    },
    MagicNumber {
        magic: 0x1002500180080280,
        shift: 54,
        offset: 45056,
        blocker_mask: 0x0008080876080800,
    },
    MagicNumber {
        magic: 0x02A0080080800C00,
        shift: 54,
        offset: 46080,
        blocker_mask: 0x001010106e101000,
    },
    MagicNumber {
        magic: 0x4804420080800400,
        shift: 54,
        offset: 47104,
        blocker_mask: 0x002020205e202000,
    },
    MagicNumber {
        magic: 0x4603410400080210,
        shift: 54,
        offset: 48128,
        blocker_mask: 0x004040403e404000,
    },
    MagicNumber {
        magic: 0x0808004200010084,
        shift: 53,
        offset: 49152,
        blocker_mask: 0x008080807e808000,
    },
    MagicNumber {
        magic: 0x0080082000400A40,
        shift: 53,
        offset: 51200,
        blocker_mask: 0x0001017e01010100,
    },
    MagicNumber {
        magic: 0x0000884002802000,
        shift: 54,
        offset: 53248,
        blocker_mask: 0x0002027c02020200,
    },
    MagicNumber {
        magic: 0x20A0002080801000,
        shift: 54,
        offset: 54272,
        blocker_mask: 0x0004047a04040400,
    },
    MagicNumber {
        magic: 0x0030801000802800,
        shift: 54,
        offset: 55296,
        blocker_mask: 0x0008087608080800,
    },
    MagicNumber {
        magic: 0x02A0080080800C00,
        shift: 54,
        offset: 56320,
        blocker_mask: 0x0010106e10101000,
    },
    MagicNumber {
        magic: 0x0002800401800200,
        shift: 54,
        offset: 57344,
        blocker_mask: 0x0020205e20202000,
    },
    MagicNumber {
        magic: 0x088008810400500E,
        shift: 54,
        offset: 58368,
        blocker_mask: 0x0040403e40404000,
    },
    MagicNumber {
        magic: 0x40C000442A000091,
        shift: 53,
        offset: 59392,
        blocker_mask: 0x0080807e80808000,
    },
    MagicNumber {
        magic: 0x0884208040008000,
        shift: 53,
        offset: 61440,
        blocker_mask: 0x00017e0101010100,
    },
    MagicNumber {
        magic: 0x2002008310420020,
        shift: 54,
        offset: 63488,
        blocker_mask: 0x00027c0202020200,
    },
    MagicNumber {
        magic: 0x0000442001030015,
        shift: 54,
        offset: 64512,
        blocker_mask: 0x00047a0404040400,
    },
    MagicNumber {
        magic: 0x000A00401222000A,
        shift: 54,
        offset: 65536,
        blocker_mask: 0x0008760808080800,
    },
    MagicNumber {
        magic: 0x8000040008008080,
        shift: 54,
        offset: 66560,
        blocker_mask: 0x00106e1010101000,
    },
    MagicNumber {
        magic: 0x10220010080A0005,
        shift: 54,
        offset: 67584,
        blocker_mask: 0x00205e2020202000,
    },
    MagicNumber {
        magic: 0x0080D00801040042,
        shift: 54,
        offset: 68608,
        blocker_mask: 0x00403e4040404000,
    },
    MagicNumber {
        magic: 0x40051084005A0001,
        shift: 53,
        offset: 69632,
        blocker_mask: 0x00807e8080808000,
    },
    MagicNumber {
        magic: 0x084000801821C580,
        shift: 53,
        offset: 71680,
        blocker_mask: 0x007e010101010100,
    },
    MagicNumber {
        magic: 0x0452804000200080,
        shift: 54,
        offset: 73728,
        blocker_mask: 0x007c020202020200,
    },
    MagicNumber {
        magic: 0x0000A00040150100,
        shift: 54,
        offset: 74752,
        blocker_mask: 0x007a040404040400,
    },
    MagicNumber {
        magic: 0x1002500180080280,
        shift: 54,
        offset: 75776,
        blocker_mask: 0x0076080808080800,
    },
    MagicNumber {
        magic: 0x0202808802040080,
        shift: 54,
        offset: 76800,
        blocker_mask: 0x006e101010101000,
    },
    MagicNumber {
        magic: 0x8002000904301200,
        shift: 54,
        offset: 77824,
        blocker_mask: 0x005e202020202000,
    },
    MagicNumber {
        magic: 0x0000020508107400,
        shift: 54,
        offset: 78848,
        blocker_mask: 0x003e404040404000,
    },
    MagicNumber {
        magic: 0x1844009401015200,
        shift: 53,
        offset: 79872,
        blocker_mask: 0x007e808080808000,
    },
    MagicNumber {
        magic: 0x1020245502408001,
        shift: 52,
        offset: 81920,
        blocker_mask: 0x7e01010101010100,
    },
    MagicNumber {
        magic: 0x0002418023001202,
        shift: 53,
        offset: 86016,
        blocker_mask: 0x7c02020202020200,
    },
    MagicNumber {
        magic: 0x8800100941A08202,
        shift: 53,
        offset: 88064,
        blocker_mask: 0x7a04040404040400,
    },
    MagicNumber {
        magic: 0x0002300009002005,
        shift: 53,
        offset: 90112,
        blocker_mask: 0x7608080808080800,
    },
    MagicNumber {
        magic: 0x2011001008000403,
        shift: 53,
        offset: 92160,
        blocker_mask: 0x6e10101010101000,
    },
    MagicNumber {
        magic: 0x22C1000204000801,
        shift: 53,
        offset: 94208,
        blocker_mask: 0x5e20202020202000,
    },
    MagicNumber {
        magic: 0x80004486480B1004,
        shift: 53,
        offset: 96256,
        blocker_mask: 0x3e40404040404000,
    },
    MagicNumber {
        magic: 0x0020408224004102,
        shift: 52,
        offset: 98304,
        blocker_mask: 0x7e80808080808000,
    },
];

pub const ROOK_ATTACK_TABLE_SIZE: usize = 102400;

pub const BISHOP_MAGICS: [MagicNumber; 64] = [
    MagicNumber {
        magic: 0x0A18211014004080,
        shift: 58,
        offset: 0,
        blocker_mask: 0x0040201008040200,
    },
    MagicNumber {
        magic: 0x0260488503082406,
        shift: 59,
        offset: 64,
        blocker_mask: 0x0000402010080400,
    },
    MagicNumber {
        magic: 0x04100C004C404000,
        shift: 59,
        offset: 96,
        blocker_mask: 0x0000004020100a00,
    },
    MagicNumber {
        magic: 0x80840C0080000000,
        shift: 59,
        offset: 128,
        blocker_mask: 0x0000000040221400,
    },
    MagicNumber {
        magic: 0x0004052002418089,
        shift: 59,
        offset: 160,
        blocker_mask: 0x0000000002442800,
    },
    MagicNumber {
        magic: 0x18408884400008A0,
        shift: 59,
        offset: 192,
        blocker_mask: 0x0000000204085000,
    },
    MagicNumber {
        magic: 0x1400460610404000,
        shift: 59,
        offset: 224,
        blocker_mask: 0x0000020408102000,
    },
    MagicNumber {
        magic: 0x092104A484044000,
        shift: 58,
        offset: 256,
        blocker_mask: 0x0002040810204000,
    },
    MagicNumber {
        magic: 0x4210103090014044,
        shift: 59,
        offset: 320,
        blocker_mask: 0x0020100804020000,
    },
    MagicNumber {
        magic: 0x0608092202860201,
        shift: 59,
        offset: 352,
        blocker_mask: 0x0040201008040000,
    },
    MagicNumber {
        magic: 0x0000212904009000,
        shift: 59,
        offset: 384,
        blocker_mask: 0x00004020100a0000,
    },
    MagicNumber {
        magic: 0x0200082080620948,
        shift: 59,
        offset: 416,
        blocker_mask: 0x0000004022140000,
    },
    MagicNumber {
        magic: 0x1400460610404000,
        shift: 59,
        offset: 448,
        blocker_mask: 0x0000000244280000,
    },
    MagicNumber {
        magic: 0x0010820910080002,
        shift: 59,
        offset: 480,
        blocker_mask: 0x0000020408500000,
    },
    MagicNumber {
        magic: 0x4052008C14024143,
        shift: 59,
        offset: 512,
        blocker_mask: 0x0002040810200000,
    },
    MagicNumber {
        magic: 0x0204004202012000,
        shift: 59,
        offset: 544,
        blocker_mask: 0x0004081020400000,
    },
    MagicNumber {
        magic: 0x8048021420082200,
        shift: 59,
        offset: 576,
        blocker_mask: 0x0010080402000200,
    },
    MagicNumber {
        magic: 0x02100408222800C0,
        shift: 59,
        offset: 608,
        blocker_mask: 0x0020100804000400,
    },
    MagicNumber {
        magic: 0x0410005200881100,
        shift: 57,
        offset: 640,
        blocker_mask: 0x004020100a000a00,
    },
    MagicNumber {
        magic: 0x0006002020214200,
        shift: 57,
        offset: 768,
        blocker_mask: 0x0000402214001400,
    },
    MagicNumber {
        magic: 0x0011000820080040,
        shift: 57,
        offset: 896,
        blocker_mask: 0x0000024428002800,
    },
    MagicNumber {
        magic: 0x8002000109100210,
        shift: 57,
        offset: 1024,
        blocker_mask: 0x0002040850005000,
    },
    MagicNumber {
        magic: 0x1002284082100200,
        shift: 59,
        offset: 1152,
        blocker_mask: 0x0004081020002000,
    },
    MagicNumber {
        magic: 0x00020008410C4107,
        shift: 59,
        offset: 1184,
        blocker_mask: 0x0008102040004000,
    },
    MagicNumber {
        magic: 0x1010880540883B12,
        shift: 59,
        offset: 1216,
        blocker_mask: 0x0008040200020400,
    },
    MagicNumber {
        magic: 0x0408208408650502,
        shift: 59,
        offset: 1248,
        blocker_mask: 0x0010080400040800,
    },
    MagicNumber {
        magic: 0x1900818010040080,
        shift: 57,
        offset: 1280,
        blocker_mask: 0x0020100a000a1000,
    },
    MagicNumber {
        magic: 0x10A0080001004008,
        shift: 55,
        offset: 1408,
        blocker_mask: 0x0040221400142200,
    },
    MagicNumber {
        magic: 0x8029840000802010,
        shift: 55,
        offset: 1920,
        blocker_mask: 0x0002442800284400,
    },
    MagicNumber {
        magic: 0x0003010003300800,
        shift: 57,
        offset: 2432,
        blocker_mask: 0x0004085000500800,
    },
    MagicNumber {
        magic: 0x8104006D84020600,
        shift: 59,
        offset: 2560,
        blocker_mask: 0x0008102000201000,
    },
    MagicNumber {
        magic: 0x080208A008C40221,
        shift: 59,
        offset: 2592,
        blocker_mask: 0x0010204000402000,
    },
    MagicNumber {
        magic: 0x4002200400608940,
        shift: 59,
        offset: 2624,
        blocker_mask: 0x0004020002040800,
    },
    MagicNumber {
        magic: 0x0802122000100100,
        shift: 59,
        offset: 2656,
        blocker_mask: 0x0008040004081000,
    },
    MagicNumber {
        magic: 0x5004004800040520,
        shift: 57,
        offset: 2688,
        blocker_mask: 0x00100a000a102000,
    },
    MagicNumber {
        magic: 0x4009020080080080,
        shift: 55,
        offset: 2816,
        blocker_mask: 0x0022140014224000,
    },
    MagicNumber {
        magic: 0x800E108400020120,
        shift: 55,
        offset: 3328,
        blocker_mask: 0x0044280028440200,
    },
    MagicNumber {
        magic: 0x6201900500108188,
        shift: 57,
        offset: 3840,
        blocker_mask: 0x0008500050080400,
    },
    MagicNumber {
        magic: 0x0024285601038080,
        shift: 59,
        offset: 3968,
        blocker_mask: 0x0010200020100800,
    },
    MagicNumber {
        magic: 0x0024285601038080,
        shift: 59,
        offset: 4000,
        blocker_mask: 0x0020400040201000,
    },
    MagicNumber {
        magic: 0x0022025040001400,
        shift: 59,
        offset: 4032,
        blocker_mask: 0x0002000204081000,
    },
    MagicNumber {
        magic: 0x400401440A101000,
        shift: 59,
        offset: 4064,
        blocker_mask: 0x0004000408102000,
    },
    MagicNumber {
        magic: 0x0220202428081004,
        shift: 57,
        offset: 4096,
        blocker_mask: 0x000a000a10204000,
    },
    MagicNumber {
        magic: 0x000202C010408208,
        shift: 57,
        offset: 4224,
        blocker_mask: 0x0014001422400000,
    },
    MagicNumber {
        magic: 0x0400202009010380,
        shift: 57,
        offset: 4352,
        blocker_mask: 0x0028002844020000,
    },
    MagicNumber {
        magic: 0x2081025482000100,
        shift: 57,
        offset: 4480,
        blocker_mask: 0x0050005008040200,
    },
    MagicNumber {
        magic: 0x00085000C0800600,
        shift: 59,
        offset: 4608,
        blocker_mask: 0x0020002010080400,
    },
    MagicNumber {
        magic: 0x0010110200801020,
        shift: 59,
        offset: 4640,
        blocker_mask: 0x0040004020100800,
    },
    MagicNumber {
        magic: 0x1400460610404000,
        shift: 59,
        offset: 4672,
        blocker_mask: 0x0000020408102000,
    },
    MagicNumber {
        magic: 0x0005005802080000,
        shift: 59,
        offset: 4704,
        blocker_mask: 0x0000040810204000,
    },
    MagicNumber {
        magic: 0xA020002308220010,
        shift: 59,
        offset: 4736,
        blocker_mask: 0x00000a1020400000,
    },
    MagicNumber {
        magic: 0x092104A484044000,
        shift: 59,
        offset: 4768,
        blocker_mask: 0x0000142240000000,
    },
    MagicNumber {
        magic: 0x2012149022020008,
        shift: 59,
        offset: 4800,
        blocker_mask: 0x0000284402000000,
    },
    MagicNumber {
        magic: 0x2012149022020008,
        shift: 59,
        offset: 4832,
        blocker_mask: 0x0000500804020000,
    },
    MagicNumber {
        magic: 0x40A00250020088A0,
        shift: 59,
        offset: 4864,
        blocker_mask: 0x0000201008040200,
    },
    MagicNumber {
        magic: 0x0260488503082406,
        shift: 59,
        offset: 4896,
        blocker_mask: 0x0000402010080400,
    },
    MagicNumber {
        magic: 0x092104A484044000,
        shift: 58,
        offset: 4928,
        blocker_mask: 0x0002040810204000,
    },
    MagicNumber {
        magic: 0x0204004202012000,
        shift: 59,
        offset: 4992,
        blocker_mask: 0x0004081020400000,
    },
    MagicNumber {
        magic: 0x0080840142080448,
        shift: 59,
        offset: 5024,
        blocker_mask: 0x000a102040000000,
    },
    MagicNumber {
        magic: 0x0020081100420209,
        shift: 59,
        offset: 5056,
        blocker_mask: 0x0014224000000000,
    },
    MagicNumber {
        magic: 0x0001400110020209,
        shift: 59,
        offset: 5088,
        blocker_mask: 0x0028440200000000,
    },
    MagicNumber {
        magic: 0x490400A4200C2102,
        shift: 59,
        offset: 5120,
        blocker_mask: 0x0050080402000000,
    },
    MagicNumber {
        magic: 0x4210103090014044,
        shift: 59,
        offset: 5152,
        blocker_mask: 0x0020100804020000,
    },
    MagicNumber {
        magic: 0x0A18211014004080,
        shift: 58,
        offset: 5184,
        blocker_mask: 0x0040201008040200,
    },
];

pub const BISHOP_ATTACK_TABLE_SIZE: usize = 5248;
